{"version":"0.3.0","body":"function main(workbook: ExcelScript.Workbook) {\n    const columnIndexB: number = 1;\n    const columnIndexG: number = 6;\n    const allowedStringsInB: string[] = [\"CSSP\",\"ISDF\",\"WEBD\",\"NADM\",\"CNST\",\"CSEC\",\"SWDV\",\"AICC\",\"CSSA\"];\n    const resultsSheetName: string = \"Filtered Results\";\n\n    let allFilteredRows: (string | number | boolean)[][] = [];\n    let headers: (string | number | boolean)[] | undefined;\n    let resultsSheet: ExcelScript.Worksheet;\n    let expectedColumnCount: number = 0; // Track the correct number of columns\n\n    const isAllowedInB = (value: string | number | boolean): boolean => {\n        const stringValue: string = String(value).trim();\n        return allowedStringsInB.includes(stringValue);\n    };\n\n    // --- Step 1: Ensure the Results Sheet exists and is defined ---\n    const existingSheet = workbook.getWorksheet(resultsSheetName);\n    if (existingSheet) { resultsSheet = existingSheet; } else { resultsSheet = workbook.addWorksheet(resultsSheetName); }\n\n    // --- Step 2: Filter Data from all other sheets ---\n    workbook.getWorksheets().forEach((sheet: ExcelScript.Worksheet) => {\n        if (sheet.getName() === resultsSheetName) { return; }\n        let dataRange: ExcelScript.Range | undefined = sheet.getUsedRange();\n        if (!dataRange || dataRange.getValues().length === 0) { return; }\n        let sheetRows: (string | number | boolean)[][] = dataRange.getValues();\n        if (sheetRows.length > 0) {\n            if (!headers) {\n                headers = sheetRows;\n                allFilteredRows.push(headers);\n                expectedColumnCount = headers.length; // Capture the header length\n            }\n            for (let i: number = 1; i < sheetRows.length; i++) {\n                let row: (string | number | boolean)[] = sheetRows[i];\n                if (row.length <= columnIndexG) { continue; }\n                let valueInB: string | number | boolean = row[columnIndexB];\n                let valueInG: string | number | boolean = row[columnIndexG];\n                if (isAllowedInB(valueInB) && valueInG !== \"X\") { allFilteredRows.push(row); }\n            }\n        }\n    });\n\n    // --- Step 3: Clear previous results and paste new data with dimension guarantee ---\n    const usedRange = resultsSheet.getUsedRange();\n    if (usedRange) { usedRange.clear(); }\n\n    if (allFilteredRows.length <= 1) {\n        console.log(\"No matching data found to output.\");\n        return;\n    }\n\n    // GUARANTEE RECTANGULAR ARRAY SHAPE:\n    // Ensure every row has exactly the expected number of columns (from the header)\n    for (let i = 0; i < allFilteredRows.length; i++) {\n        while (allFilteredRows[i].length < expectedColumnCount) {\n            allFilteredRows[i].push(\"\"); // Pad missing cells with empty strings\n        }\n        allFilteredRows[i] = allFilteredRows[i].slice(0, expectedColumnCount); // Truncate extra cells\n    }\n\n    // Determine target range dimensions correctly\n    let numRows: number = allFilteredRows.length;\n    let numCols: number = expectedColumnCount;\n\n    // Define the range dimensions exactly using the calculated rows and columns\n    let targetRange = resultsSheet.getRangeByIndexes(0, 0, numRows, numCols);\n\n    // This line should now work:\n    targetRange.setValues(allFilteredRows);\n\n    console.log(`Wrote ${numRows - 1} filtered rows to the '${resultsSheetName}' sheet.`);\n}","description":"","noCodeMetadata":"","parameterInfo":"{\"version\":1,\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}},\"signature\":{\"comment\":\"\",\"parameters\":[{\"name\":\"workbook\",\"comment\":\"\"}]}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}